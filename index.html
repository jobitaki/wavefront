<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>wavefront – Dataflow Token Visualizer</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;600;700&family=Orbit&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Graphviz WASM library for rendering DOT graphs -->
    <script src="https://cdn.jsdelivr.net/npm/@hpcc-js/wasm@2.5.0/dist/graphviz.umd.js"></script>
    <!-- D3.js for SVG manipulation utilities -->
    <script src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="visualization">
            <div id="graph-container">
                <div class="loading" id="loadingMessage">
                    <div class="modal-header">
                        <h2>Upload Graph & Log</h2>
                    </div>
                    <div class="upload-grid">
                        <div class="drop-zone" id="dotDrop">
                            <div class="drop-title">DOT Graph (.dot)</div>
                            <div class="drop-instructions">Drag & drop a .dot file here, or click to choose</div>
                            <input type="file" id="dotFile" accept=".dot" style="display:none" />
                            <div class="file-status" id="dotStatus">No file selected</div>
                        </div>

                        <div class="drop-zone" id="fireDrop">
                            <div class="drop-title">Fire Log (.log/.txt)</div>
                            <div class="drop-instructions">Drag & drop a fire log here, or click to choose</div>
                            <input type="file" id="fireLog" accept=".log,.txt" style="display:none" />
                            <div class="file-status" id="fireLogStatus">No file selected</div>
                        </div>
                    </div>
                    <div id="loadingNote" style="margin-top:12px; font-size:0.9em; color:#666;">Both files required — the UI will appear once finished.</div>
                    <div class="upload-footer" style="margin-top:14px;">
                        <a class="github-btn" href="https://github.com/jobitaki/wavefront" target="_blank" rel="noopener noreferrer">
                            <i class="fa-brands fa-github"></i>
                            <span>View on GitHub</span>
                        </a>
                    </div>
                </div>
                <svg id="graph-svg"></svg>
            </div>
        </div>

        <header>
            <h1>wavefront</h1>
        </header>

        <div class="zoom-controls">
            <button class="zoom-btn" id="zoomInBtn" title="Zoom In"><i class="fa-solid fa-plus" aria-hidden="true"></i></button>
            <button class="zoom-btn" id="zoomResetBtn" title="Reset View"><i class="fa-solid fa-arrows-rotate" aria-hidden="true"></i></button>
            <button class="zoom-btn" id="zoomOutBtn" title="Zoom Out"><i class="fa-solid fa-minus" aria-hidden="true"></i></button>
        </div>

        <div class="stats" id="stats" style="display: none;">
            <div class="stat-box">
                <div class="stat-label">Total Cycles</div>
                <div class="stat-value" id="totalCycles">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Nodes in Graph</div>
                <div class="stat-value" id="totalNodes">0</div>
            </div>
        </div>

        <div class="playback-controls" style="display: none;" id="playbackControls">
            <div class="cycle-info">
                <span class="cycle-display">Cycle: <span id="currentCycle">0</span></span>
                <span class="cycle-display" style="margin-left: 20px;">Instructions: <span id="cycleInstrCount">0</span></span>
            </div>
            <button class="btn-primary" id="playBtn" disabled title="Play">
                <i class="fa-solid fa-play" aria-hidden="true"></i>
            </button>
            <button class="btn-secondary" id="pauseBtn" disabled title="Pause">
                <i class="fa-solid fa-pause" aria-hidden="true"></i>
            </button>
            <button class="btn-secondary" id="prevBtn" disabled title="Previous Cycle">
                <i class="fa-solid fa-step-backward" aria-hidden="true"></i>
            </button>
            <button class="btn-secondary" id="nextBtn" disabled title="Next Cycle">
                <i class="fa-solid fa-step-forward" aria-hidden="true"></i>
            </button>
            <button class="btn-secondary" id="resetBtn" disabled title="Reset">
                <i class="fa-solid fa-rotate-left" aria-hidden="true"></i>
            </button>
            <div class="queue-toggle-container">
                <label class="switch">
                    <input type="checkbox" id="queueToggleBtn">
                    <span class="slider"></span>
                </label>
                <span class="queue-toggle-label">Toggle queueing (buggy)</span>
            </div>
            <div class="speed-control">
                <label for="speedSlider">Speed:</label>
                <input type="range" id="speedSlider" min="1" max="10" value="5" step="1" />
                <span id="speedValue">5x</span>
            </div>
        </div>

        <div class="execution-log" id="executionLog" style="display: none;">
            <!-- Execution entries will be added here -->
        </div>

    </div>

    <script src="app.js"></script>
</body>
</html>
