<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wavefront - Dataflow Viewer</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;600;700&family=Orbit&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Graphviz WASM library for rendering DOT graphs -->
    <script src="https://cdn.jsdelivr.net/npm/@hpcc-js/wasm@2.5.0/dist/graphviz.umd.js"></script>
    <!-- D3.js for SVG manipulation utilities -->
    <script src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Initial Upload Modal -->
        <div class="loading" id="loadingMessage">
            <div class="modal-header">
                <h2>Upload Graph & Log</h2>
            </div>
            <div class="upload-grid">
                <div class="drop-zone" id="dotDrop">
                    <div class="drop-title">DOT Graph (.dot)</div>
                    <div class="drop-instructions">Drag & drop a .dot file here, or click to choose</div>
                    <input type="file" id="dotFile" accept=".dot" style="display:none" />
                    <div class="file-status" id="dotStatus">No file selected</div>
                </div>

                <div class="drop-zone" id="fireDrop">
                    <div class="drop-title">Fire Log (.log/.txt)</div>
                    <div class="drop-instructions">Drag & drop a fire log here, or click to choose</div>
                    <input type="file" id="fireLog" accept=".log,.txt" style="display:none" />
                    <div class="file-status" id="fireLogStatus">No file selected</div>
                </div>
            </div>
            <div id="loadingNote" style="margin-top:12px; font-size:0.9em; color:rgba(0, 0, 0, 0.5);">Both files required â€” the UI will appear once finished.</div>
            <div class="upload-footer" style="margin-top:14px; display:flex; gap:16px; align-items:center;">
                <button class="example-btn" id="loadExampleBtn">
                    <i class="fa-solid fa-file-arrow-down"></i>
                    <span>Load Example</span>
                </button>
                <a class="github-btn" href="https://github.com/jobitaki/wavefront" target="_blank" rel="noopener noreferrer">
                    <i class="fa-brands fa-github"></i>
                    <span>View on GitHub</span>
                </a>
            </div>
        </div>

        <!-- Top Menu Bar -->
        <div class="top-menu-bar" id="topMenuBar">
            <div class="menu-section menu-left">
                <div class="app-title">
                    <img src="media/wavefront_logo.png" alt="Wavefront Logo" class="app-logo">
                    <!-- <span>wavefront</span> -->
                </div>
                <div class="menu-group">
                    <button class="menu-btn" id="fileMenuBtn" title="File Menu">
                        <i class="fa-solid fa-folder-open"></i>
                        <span>File</span>
                    </button>
                    <div class="file-dropdown" id="fileDropdown">
                        <div class="dropdown-item" id="reuploadDot">
                            <i class="fa-solid fa-file-code"></i>
                            <span>Reupload DOT Graph</span>
                        </div>
                        <div class="dropdown-item" id="reuploadFireLog">
                            <i class="fa-solid fa-file-lines"></i>
                            <span>Reupload Fire Log</span>
                        </div>
                    </div>
                </div>
                <div class="menu-group search-group">
                    <div class="search-container">
                        <i class="fa-solid fa-magnifying-glass search-icon"></i>
                        <input type="text" id="searchInput" class="search-input" placeholder="Search instructions or tokens..." />
                        <button class="search-clear-btn" id="searchClearBtn" title="Clear search">
                            <i class="fa-solid fa-xmark"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="menu-section menu-center">
                <div class="menu-group playback-group">
                    <button class="menu-icon-btn" id="playBtn" disabled title="Play">
                        <i class="fa-solid fa-play"></i>
                    </button>
                    <button class="menu-icon-btn" id="pauseBtn" disabled title="Pause">
                        <i class="fa-solid fa-pause"></i>
                    </button>
                    <button class="menu-icon-btn" id="prevBtn" disabled title="Previous Cycle">
                        <i class="fa-solid fa-step-backward"></i>
                    </button>
                    <button class="menu-icon-btn" id="nextBtn" disabled title="Next Cycle">
                        <i class="fa-solid fa-step-forward"></i>
                    </button>
                    <button class="menu-icon-btn" id="resetBtn" disabled title="Reset">
                        <i class="fa-solid fa-rotate-left"></i>
                    </button>
                </div>
                
                <div class="menu-divider"></div>
                
                <div class="menu-group cycle-jump-group">
                    <label class="cycle-label">Cycle:</label>
                    <input type="number" id="jumpToCycleInput" class="cycle-input" value="0" min="0" disabled />
                    <button class="menu-icon-btn" id="jumpToCycleBtn" disabled title="Jump to Cycle">
                        <i class="fa-solid fa-arrow-right"></i>
                    </button>
                </div>
                
                <div class="menu-divider"></div>
                
                <div class="menu-group step-size-group">
                    <label class="cycle-label">Step:</label>
                    <input type="number" id="stepSizeInput" class="cycle-input" value="1" min="1" disabled />
                </div>
                
                <div class="menu-divider"></div>
                
                <div class="menu-group zoom-group">
                    <button class="menu-icon-btn" id="zoomInBtn" title="Zoom In">
                        <i class="fa-solid fa-magnifying-glass-plus"></i>
                    </button>
                    <button class="menu-icon-btn" id="zoomOutBtn" title="Zoom Out">
                        <i class="fa-solid fa-magnifying-glass-minus"></i>
                    </button>
                    <button class="menu-icon-btn" id="zoomResetBtn" title="Reset View">
                        <i class="fa-solid fa-arrows-rotate"></i>
                    </button>
                </div>
                
                <div class="menu-divider"></div>
                
                <div class="menu-group queue-group">
                    <label class="switch">
                        <input type="checkbox" id="queueToggleBtn" autocomplete="off">
                        <span class="slider"></span>
                    </label>
                    <span class="queue-label">Queue</span>
                </div>
                
                <div class="menu-divider"></div>
                
                <div class="menu-group speed-group">
                    <label class="speed-label">Speed:</label>
                    <input type="range" id="speedSlider" min="1" max="10" value="5" step="1" />
                    <span id="speedValue">5x</span>
                </div>
            </div>
        </div>

        <!-- Left Sidebar for Execution Log -->
        <div class="sidebar-left" id="sidebarLeft">
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="fa-solid fa-chevron-left"></i>
            </button>
            <div class="sidebar-content">
                <div class="sidebar-header">Execution Log</div>
                <div class="sidebar-stats">
                    <div class="sidebar-info-item">
                        <span class="sidebar-info-label">Total Cycles:</span>
                        <span class="sidebar-info-value" id="totalCycles">0</span>
                    </div>
                    <div class="sidebar-info-item">
                        <span class="sidebar-info-label">Instructions:</span>
                        <span class="sidebar-info-value" id="cycleInstrCount">0</span>
                    </div>
                    <div class="sidebar-info-item">
                        <span class="sidebar-info-label">Nodes:</span>
                        <span class="sidebar-info-value" id="totalNodes">0</span>
                    </div>
                </div>
                <div class="execution-log" id="executionLog">
                    <!-- Execution entries will be added here -->
                </div>
            </div>
        </div>

        <!-- Main Graph Container -->
        <div class="visualization sidebar-open" id="visualization">
            <div id="graph-container">
                <svg id="graph-svg"></svg>
            </div>
        </div>

    </div>

    <!-- Hidden file inputs for reuploading -->
    <input type="file" id="reuploadDotFile" accept=".dot" style="display:none" />
    <input type="file" id="reuploadFireLogFile" accept=".log,.txt" style="display:none" />

    <script src="app.js"></script>
</body>
</html>
